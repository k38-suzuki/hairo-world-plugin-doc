
通信障害効果の設定
==================

ここでは、TCシミュレータを使った通信障害効果の設定の仕方を説明します。

.. note::
  | TCシミュレータは、Choreonoidのワールド内のロボットをOpenRTM・ROS等を用いてイーサネット経由で操縦する場合に使用できます。

TCシミュレータアイテムの作成と設定
----------------------------------

ここではChoreonoidの標準のシミュレータアイテムである「AISTシミュレータ」を用います。メインメニューの「ファイル」-「新規」-「TCシミュレータ」を選択して生成してください。生成したTCシミュレータは、AISTシミュレータアイテムの小アイテムとして配置します。

.. image:: images/traffic_0.png

TCエリアアイテムの作成と設定
----------------------------

TCエリアアイテムは、Choreonoidのワールド内の通信障害を適用するエリアを定義するためのアイテムです。メインメニューの「ファイル」-「新規」-「TCエリア」を選択して生成してください。生成したTCエリアアイテムは、ワールドアイテムの小アイテムとして配置します。以下の例では、TCエリアアイテムを「Traffic0」〜「Traffic3」として4つ生成しています。このように複数のTCエリアアイテムを生成することで、Choreonoidのワールド内でより詳細に通信障害をエミュレートすることができます。

.. note::
  | 複数のTCエリアアイテムを使用する場合、各アイテムの対象範囲が重複する場合があります。重複が発生した場合は、アイテムツリービューに登録されているより下位のTCエリアアイテムの設定が適用されます。

.. image:: images/traffic_1.png

このTCアイテムはアイテムツリービューのチェックボックスを使用して表示・非表示を切り替えることができます。また、非表示のTCエリアアイテムはシミュレーションの対象から除外されます。

TCエリアアイテムのパラメータは以下の通りです。

.. list-table::
  :widths: 20,12,12,75
  :header-rows: 1

  * - パラメータ
    - デフォルト値
    - 単位
    - 意味
  * - 内向き遅延
    - 0
    - ms
    - パケットを受信する際の遅延時間を指定します。
  * - 内向きレイテンシ
    - 0
    - kbit\s
    - パケットを受信する際のレイテンシ（通信速度の上限）を指定します。
  * - 内向きパケット損失
    - 0
    - %
    - パケットを受信する際のパケット損失率を指定します。
  * - 外向き遅延
    - 0
    - ms
    - パケットを送信する際の遅延時間を指定します。
  * - 外向きレイテンシ
    - 0
    - kbit\s
    - パケットを送信する際のレイテンシ（通信速度の上限）を指定します。
  * - 外向きパケット損失
    - 0
    - %
    - パケットを送信する際のパケット損失率を指定します。
  * - 送信元IPアドレス
    - 0.0.0.0
    - \-
    - パケットの送信元を限定する際のIPアドレスを指定します。
  * - 送信先IPアドレス
    - 0.0.0.0
    - \-
    - パケットの送信先を限定する際のIPアドレスを指定します。
  * - 形状
    - Box
    - \-
    - TCエリアの形状を指定します。(Box/Cylinder/Sphere)
  * - サイズ
    - 1.0, 1.0, 1.0
    - m, m, m
    - TCエリアのサイズをXYZで指定します。（形状がBoxの場合のみ）
  * - 半径
    - 1.0
    - m
    - TCエリアの半径を指定します。（形状がCylinder・Sphereの場合のみ）
  * - 高さ
    - 1.0
    - m
    - TCエリアの高さを指定します。（形状がCylinderの場合のみ）
  * - 位置
    - 0, 0, 0
    - m, m, m
    - TCエリアの位置をXYZで指定します。
  * - 中心軸
    - X
    - \-
    - TCエリアの向きを指定します。（形状がCylinderの場合のみ）
  * - 拡散色
    - 0, 0, 0
    - \-, -, -
    - TCエリアの拡散色をRGBで指定します。
  * - 透過度
    - 0
    - \-
    - TCエリアの透過度を指定します。

シミュレーションの実行
----------------------

シミュレーションバーから通常通りシミュレーションを実行してください。シミュレーションに成功するとTCエリアアイテムの設定に基づいた通信障害の効果が設定されます。効果の適用状況はpingコマンドを使用して確認できます。

