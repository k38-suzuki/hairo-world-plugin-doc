
通信障害効果の設定
==================

ここでは、ネットワークエミュレータを使った通信障害効果の設定の仕方を説明します。

.. note::
  | ネットワークエミュレータは、Choreonoidのワールド内のロボットをOpenRTM・ROS等を用いてイーサネット経由で操縦する場合に使用できます。

ネットワークエミュレータアイテムの作成と設定
--------------------------------------------

ここではChoreonoidの標準のシミュレータアイテムである「AISTシミュレータ」を用います。メインメニューの「ファイル」-「新規」-「ネットワークエミュレータ」を選択して生成してください。生成したネットワークエミュレータは、AISTシミュレータアイテムの子アイテムとして配置します。

マルチコライダアイテムの作成と設定
----------------------------------

マルチコライダアイテムは、Choreonoidのワールド内の通信障害を適用する領域を定義するためのアイテムです。メインメニューの「ファイル」-「新規」-「マルチコライダ」を選択して、タイプ「通信障害」を指定して生成してください。生成したマルチコライダアイテムは、ワールドアイテムの子アイテムとして配置します。以下の例では、マルチコライダアイテムを「Traffic0」〜「Traffic3」として4つ生成しています。このように複数のマルチコライダアイテムを生成することで、Choreonoidのワールド内でより詳細に通信障害を適用する領域を設定することもできます。

.. note::
  | 複数のマルチコライダアイテムを使用する場合、各アイテムの対象範囲が重複する場合があります。重複が発生した場合は、アイテムツリービューに登録されているより下位のマルチコライダアイテムの設定が適用されます。

このTCアイテムはアイテムツリービューのチェックボックスを使用して表示・非表示を切り替えることができます。また、非表示のマルチコライダアイテムはシミュレーションの対象から除外されます。

マルチコライダアイテムのパラメータは以下の通りです。

.. list-table::
  :widths: 20,12,12,75
  :header-rows: 1

  * - パラメータ
    - デフォルト値
    - 単位
    - 意味
  * - 内向き遅延
    - 0
    - ms
    - パケットを受信する際の遅延時間を指定します。
  * - 内向きレイテンシ
    - 0
    - kbit\s
    - パケットを受信する際のレイテンシ（通信速度の上限）を指定します。
  * - 内向きパケット損失
    - 0
    - %
    - パケットを受信する際のパケット損失率を指定します。
  * - 外向き遅延
    - 0
    - ms
    - パケットを送信する際の遅延時間を指定します。
  * - 外向きレイテンシ
    - 0
    - kbit\s
    - パケットを送信する際のレイテンシ（通信速度の上限）を指定します。
  * - 外向きパケット損失
    - 0
    - %
    - パケットを送信する際のパケット損失率を指定します。
  * - 送信元IPアドレス
    - 0.0.0.0
    - \-
    - パケットの送信元を限定する際のIPアドレスを指定します。
  * - 送信先IPアドレス
    - 0.0.0.0
    - \-
    - パケットの送信先を限定する際のIPアドレスを指定します。
  * - 形状
    - Box
    - \-
    - 領域の形状を指定します。(Box/Cylinder/Sphere)
  * - サイズ
    - 1.0, 1.0, 1.0
    - m, m, m
    - 領域のサイズをXYZで指定します。（形状がBoxの場合のみ）
  * - 半径
    - 1.0
    - m
    - 領域の半径を指定します。（形状がCylinder・Sphereの場合のみ）
  * - 高さ
    - 1.0
    - m
    - 領域の高さを指定します。（形状がCylinderの場合のみ）
  * - 位置
    - 0, 0, 0
    - m, m, m
    - 領域の位置をXYZで指定します。
  * - RPY
    - 0, 0, 0
    - deg, deg, deg
    - 領域の向きをRoll, Pitch, Yawで指定します。
  * - 拡散色
    - 0, 0, 0
    - \-, -, -
    - 領域の拡散色をRGBで指定します。
  * - 透過度
    - 0
    - \-
    - 領域の透過度を指定します。

シミュレーションの実行
----------------------

シミュレーションバーから通常通りシミュレーションを実行してください。シミュレーションに成功するとマルチコライダアイテムの設定に基づいた通信障害の効果が設定されます。効果の適用状況はpingコマンドを使用して確認できます。

