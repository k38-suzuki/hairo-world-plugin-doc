
NetEmプラグイン(通信障害効果の設定)
===================================

ここでは、ネットワークエミュレータを使った通信障害効果の設定の仕方を説明します。

.. note::
  | ネットワークエミュレータは、Choreonoidのワールド内のロボットをOpenRTM・ROS等を用いてイーサネット経由で操縦する場合に使用できます。

お知らせ
--------

2022年3月22日の更新で、プラグイン名を変更しました。
（旧）TCPlugin　→　（新）NetEmPlugin

これに伴い、更新前のバージョンで作成されたプロジェクト（``*.cnoid``）の読み込みができなくなります。
つきましては、下記のとおりファイルを修正してください。

TCシミュレータの修正）

plugin: TC →　plugin: NetEm

class: TCSimulatorItem →　class: NetworkEmulatorItem

通信領域アイテムの修正）

plugin: TC →　plugin: NetEm

ネットワークエミュレータアイテムの作成と設定
--------------------------------------------

ここではChoreonoidの標準のシミュレータアイテムである「AISTシミュレータ」を用います。メインメニューの「ファイル」-「新規」-「ネットワークエミュレータ」を選択して生成してください。生成したネットワークエミュレータは、AISTシミュレータアイテムの子アイテムとして配置します。

通信領域アイテムの作成と設定
----------------------------

通信領域アイテムは、Choreonoidのワールド内の通信障害を適用するエリアを定義するためのアイテムです。メインメニューの「ファイル」-「新規」-「通信領域」を選択して生成してください。生成した通信領域アイテムは、ワールドアイテムの子アイテムとして配置します。以下の例では、通信領域アイテムを「Traffic0」〜「Traffic3」として4つ生成しています。このように複数の通信領域アイテムを生成することで、Choreonoidのワールド内でより詳細に通信障害をエミュレートすることができます。

.. note::
  | 複数の通信領域アイテムを使用する場合、各アイテムの対象範囲が重複する場合があります。重複が発生した場合は、アイテムツリービューに登録されているより下位の通信領域アイテムの設定が適用されます。

このTCアイテムはアイテムツリービューのチェックボックスを使用して表示・非表示を切り替えることができます。また、非表示の通信領域アイテムはシミュレーションの対象から除外されます。

通信領域アイテムのパラメータは以下の通りです。

.. list-table::
  :widths: 20,12,12,75
  :header-rows: 1

  * - パラメータ
    - デフォルト値
    - 単位
    - 意味
  * - 内向き遅延
    - 0
    - ms
    - パケットを受信する際の遅延時間を指定します。
  * - 内向きレイテンシ
    - 0
    - kbit\s
    - パケットを受信する際のレイテンシ（通信速度の上限）を指定します。
  * - 内向きパケット損失
    - 0
    - %
    - パケットを受信する際のパケット損失率を指定します。
  * - 外向き遅延
    - 0
    - ms
    - パケットを送信する際の遅延時間を指定します。
  * - 外向きレイテンシ
    - 0
    - kbit\s
    - パケットを送信する際のレイテンシ（通信速度の上限）を指定します。
  * - 外向きパケット損失
    - 0
    - %
    - パケットを送信する際のパケット損失率を指定します。
  * - 送信元IPアドレス
    - 0.0.0.0
    - \-
    - パケットの送信元を限定する際のIPアドレスを指定します。
  * - 送信先IPアドレス
    - 0.0.0.0
    - \-
    - パケットの送信先を限定する際のIPアドレスを指定します。
  * - 形状
    - Box
    - \-
    - 通信領域の形状を指定します。(Box/Cylinder/Sphere)
  * - サイズ
    - 1.0, 1.0, 1.0
    - m, m, m
    - 通信領域のサイズをXYZで指定します。（形状がBoxの場合のみ）
  * - 半径
    - 1.0
    - m
    - 通信領域の半径を指定します。（形状がCylinder・Sphereの場合のみ）
  * - 高さ
    - 1.0
    - m
    - 通信領域の高さを指定します。（形状がCylinderの場合のみ）
  * - 位置
    - 0, 0, 0
    - m, m, m
    - 通信領域の位置をXYZで指定します。
  * - RPY
    - 0, 0, 0
    - deg, deg, deg
    - 通信領域の向きをRoll, Pitch, Yawで指定します。
  * - 拡散色
    - 0, 0, 0
    - \-, -, -
    - 通信領域の拡散色をRGBで指定します。
  * - 透過度
    - 0
    - \-
    - 通信領域の透過度を指定します。

シミュレーションの実行
----------------------

シミュレーションバーから通常通りシミュレーションを実行してください。シミュレーションに成功すると通信領域アイテムの設定に基づいた通信障害の効果が設定されます。効果の適用状況はpingコマンドを使用して確認できます。

