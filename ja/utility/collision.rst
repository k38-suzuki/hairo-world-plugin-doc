
干渉の可視化・記録
==================

ここでは、シミュレーションに使用している動的モデルの干渉の表示と記録の仕方を説明します。この機能では、動的モデルのリンク毎の干渉を可視化するためのものです。リンクが他の物体に干渉している場合は、そのリンクの干渉モデルの色が赤色に、干渉していない場合は白色に変更されます。また、この機能では、動的モデルのリンク毎の干渉を記録し、ファイル出力することができます。

干渉の可視化・記録の設定
------------------------

干渉の可視化・記録を行うCollisionVisualizerを生成します。
ここでは、Choreonoidの標準のシミュレータアイテムである「AISTシミュレータ」を用います。メインメニューの「ファイル」-「新規」-「干渉可視化」を選択して「CollisionVisualizer」生成してください。生成したCollisionVisualizerは、AISTシミュレータアイテムの小アイテムとして配置します。

.. image:: images/collision_0.png

また、CollisionVisualizerでは以下の設定ができます。

.. list-table::
  :widths: 20,12,8,75
  :header-rows: 1

  * - パラメータ
    - デフォルト値
    - 単位
    - 意味
  * - 対象ボティ
    - \
    - \-
    - 干渉を可視化するボディを指定します。指定がない場合は、全てのボティが対象になります。複数選択する場合は、スペース区切りで指定します。
  * - 干渉の記録
    - false
    - \-
    - trueの場合に干渉を記録します。

次に、ツールバーに表示されている「干渉チェック用モデルを表示」または「表示するモデルタイプの切り替え」のアイコンを押し、干渉モデルを表示します。
また、干渉を記録するときは、以下の手順でCollisionVisualizerの設定を変更します。

1. アイテムツリービュー上で「OperationReviewCollector」を選択する。
2. プロパティビュー上で「干渉の記録」の設定を「true」に変更する。

シミュレーションの実行
----------------------

シミュレーションバーから通常通りシミュレーションを実行してください。シミュレーションに成功すると干渉が検知されたリンクの干渉モデルが赤色に表示されます。また、干渉を記録している場合は、ボディの干渉を記録したアイテム「Collision States」がCollisionVisualizerの小アイテムとして自動生成されます。

.. image:: images/collision_1.png

干渉のファイル出力
------------------

以下の手順で記録した干渉をファイル出力します。

1. シミュレーション実行後に自動生成されたアイテム「Collision States」を選択する。
2. 「メニュー」-「ファイル」から「選択したアイテムのエクスポート」を選択する。
3. 表示されるダイアログにファイル名を入力し、「保存」ボタンを押す。

干渉のグラフ表示
----------------

以下の手順で記録した干渉をグラフ表示できます。

1. 「メニュー」-「表示」-「ビューの表示」から「Multi Value Seq」を選択する。
2. グラフ表示を行うアイテム「Collision States」を選択する。
3. Multi Value Seqビューの左側に表示されている数字（jointId）を選択する。

